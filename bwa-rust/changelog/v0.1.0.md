# Changelog - v0.1.0

## 阶段 0: 项目基线与参考数据
- 创建开发脚本 `scripts/run_index.sh`、`scripts/run_align.sh`、`scripts/compare.sh`
- 创建 BWA 基准结果文档 `data/README.md`
- 更新 README 明确项目目标与范围

## 阶段 1: 索引模块稳定化
- `FMIndex` 新增 `IndexMeta` 可选元数据结构（参考文件名、命令参数、构建时间戳）
- 索引版本号升级至 v2（向后兼容 v1）
- `run_index` 自动记录构建元数据
- 添加 `chrono` 依赖用于时间戳

## 阶段 2: 对齐增强
- 重构 `align` 模块为子模块结构：`seed.rs`、`chain.rs`、`sw.rs`、`mod.rs`
- 添加 `lib.rs` 支持 library 模式使用

## 阶段 3: BWA-MEM 风格单端对齐
- **SMEM 种子查找** (`align/seed.rs`)
  - 基于 backward_search 的 MEM/SMEM 搜索
  - 过滤被包含的 MEM，保留超级最大精确匹配
  - `AlnReg` 结构体设计
- **种子链构建与过滤** (`align/chain.rs`)
  - DP 方法构建最佳链
  - 贪心剥离提取多条链 (`build_chains`)
  - 链过滤：按得分比例和 read 覆盖重叠去除弱链/冗余链 (`filter_chains`)
- **改进对齐输出** (`align/mod.rs`)
  - 多链候选生成 + 去重
  - 主/次要比对 FLAG（0x10 反向、0x100 secondary）
  - 改进 MAPQ 估算（唯一比对加分、主次接近降分）
  - SAM header 增加 @HD、@PG 行
  - 限制输出比对数量（最多 5 条）

## 阶段 4: 性能优化与工程化
- **criterion 基准测试** (`benches/benchmarks.rs`)
  - backward_search、SMEM 种子、banded SW、SA 构建基准
- **多线程支持**
  - 添加 `rayon` 依赖，`--threads` / `-t` CLI 参数
  - 批量读取 FASTQ + rayon 并行处理
  - FM index 通过 `Arc` 安全共享
- **内存优化**
  - Smith-Waterman 可复用工作缓冲区 (`SwBuffer`)
  - 稀疏 SA 采样支持 (`build_sparse`、`sa_value` LF-mapping 恢复)
  - `sa_interval_positions` 兼容稀疏/完整 SA

## 阶段 5: 文档、示例与长期维护
- **架构文档** (`docs/architecture.md`)
  - 模块划分、索引格式、对齐算法流程图
  - 与 BWA/BWA-MEM 的主要差异对比表
  - 技术栈说明
- **教程** (`docs/tutorial.md`)
  - 从 0 实现 BWA 风格 FM 索引和对齐器的 6 步教程
- **示例** (`examples/simple_align.rs`)
  - 演示 library 模式使用：索引构建、精确匹配、SMEM、SW、种子链
- **CI 配置** (`.github/workflows/ci.yml`)
  - GitHub Actions：fmt check、clippy、test、release build
- **README 完善**
  - 新增功能列表、多线程说明、文档链接、基准测试和示例入口
- **ROADMAP 更新**
  - 所有任务项标记为已完成
